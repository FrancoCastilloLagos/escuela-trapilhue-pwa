<div class="dashboard-wrapper fade-in-viewer">
  
  <app-header></app-header>

  <div class="title-section-container">
    <div class="news-header-badge">ANALÍTICA DE RENDIMIENTO</div>
  </div>

  <main class="dashboard-body">
    <div class="layout-container">
      <aside class="sidebar-info">
        <div class="glass-card">
          <h3 class="sidebar-title">FILTROS ANALÍTICOS</h3>
          <div class="selectors-stack">
            <ng-container *ngIf="esDocente">
              <select [(ngModel)]="idCursoSel" (change)="onCursoChange()" class="clean-select-dark">
                <option [ngValue]="null">Seleccione Curso</option>
                <option *ngFor="let c of cursos" [ngValue]="c.id_curso">{{ c.nombre_curso }}</option>
              </select>
              <select [(ngModel)]="idEstudianteSel" (change)="onEstudianteChange()" class="clean-select-dark" [disabled]="!idCursoSel">
                <option [ngValue]="null">Seleccione Estudiante</option>
                <option *ngFor="let e of estudiantes" [ngValue]="e.id_estudiante">{{ e.nombre_completo }}</option>
              </select>
            </ng-container>

            <select [(ngModel)]="idAsignaturaSel" (change)="obtenerDatosGrafico()" class="clean-select-dark" [disabled]="!idEstudianteSel">
              <option [ngValue]="null">Asignatura</option>
              <option *ngFor="let a of asignaturas" [ngValue]="a.id_asignatura">{{ a.nombre }}</option>
            </select>
          </div>

          <div class="analitica-box-glass sumativo" [class.danger-alert]="alertaSumativa">
              <strong>ANALÍTICA SUMATIVA:</strong><br>{{ mensajeSumativo }}
          </div>
          <div class="analitica-box-glass formativo" [class.danger-alert]="alertaFormativa">
              <strong>PROCESO FORMATIVO:</strong><br>{{ mensajeFormativo }}
          </div>
        </div>
      </aside>

      <section class="news-section">
        <div class="dual-charts-grid">
          <div class="news-display-card">
            <div class="chart-header">CALIFICACIONES SUMATIVAS</div>
            <div class="chart-container-wrapper">
                <canvas #sumativasChart></canvas>
            </div>
          </div>
          <div class="news-display-card">
            <div class="chart-header">DESEMPEÑO FORMATIVO</div>
            <div class="chart-container-wrapper">
                <canvas #formativasChart></canvas>
            </div>
          </div>
        </div>
        
        <div class="news-display-card table-card" *ngIf="notasActuales.length > 0">
          <div class="table-area">
            <div class="table-title">Historial de Calificaciones</div>
            <div class="table-scroll">
              <table class="minimal-table">
                <thead>
                  <tr><th>EVALUACIÓN</th><th>VALOR</th><th>TIPO</th></tr>
                </thead>
                <tbody>
                  <tr *ngFor="let n of notasActuales">
                    <td>{{ n.descripcion || n.nombre_evaluacion }}</td>
                    <td [class.red-text]="n.valor < 4.0" class="bold-text">{{ n.valor | number:'1.1-1' }}</td>
                    <td><span class="badge-tipo" [class.sum]="n.tipo?.toUpperCase() !== 'FORMATIVA'">{{ n.tipo || 'Sumativa' }}</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="minimal-footer">
    <p>Copyright © 2026 | <span>KALINK DISEÑOS</span></p>
  </footer>
</div>