<div class="dashboard-wrapper" (click)="menuOpen = false">
  <header class="header-main">
    <div class="header-left-action">
      <button class="btn-back-nav" (click)="volverDashboard()"><span>‚¨Ö</span> VOLVER</button>
    </div>
    
    <div class="logo-wrapper">
      <div class="logo-white-bg">
        <img src="assets/logo-escuela.png" alt="Logo Escuela" class="img-logo" style="width: 80%;">
      </div>
    </div>
    
    <div class="user-profile-pill">
      <span>{{ userRol }}: {{ userName }}</span>
      <button class="menu-trigger" (click)="toggleMenu($event)">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </button>
      
      <div class="dropdown-floating-menu" *ngIf="menuOpen" (click)="$event.stopPropagation()">
        <button class="dropdown-item" (click)="irAConfig()">‚öôÔ∏è Configuraci√≥n</button>
        <div style="height: 1px; background: #eee; margin: 5px 0;"></div>
        <button class="dropdown-item" (click)="cerrarSesion()">üö™ Cerrar sesi√≥n</button>
      </div>
    </div>
  </header>

  <div class="title-section-container">
    <div class="badge-title-dark">GESTI√ìN DE FECHAS EVALUACIONES</div>
  </div>

  <main class="main-content-area">
    <div class="selectors-row">
      <div class="select-box">
        <select [(ngModel)]="seleccion.curso" (change)="onCursoChange()" class="clean-select">
          <option [ngValue]="null">Curso</option>
          <option *ngFor="let c of cursos" [ngValue]="c.id_curso">{{ c.nombre_curso }}</option>
        </select>
      </div>

      <div class="select-box">
        <select [(ngModel)]="seleccion.asignatura" (change)="onAsignaturaChange()" class="clean-select" [disabled]="!seleccion.curso">
          <option [ngValue]="null">Asignatura</option>
          <option *ngFor="let a of asignaturas" [ngValue]="a.id_asignatura">{{ a.nombre }}</option>
        </select>
      </div>
    </div>

    <div class="panels-grid">
      <section class="card-dark-panel">
        <h3 class="panel-title">{{ seleccion.id_fecha_edicion ? 'Actualizar Fecha' : 'Nueva Evaluaci√≥n' }}</h3>
        
        <textarea
          [(ngModel)]="seleccion.contenido"
          placeholder="Ej: Prueba Sumativa Unidad 2: Fracciones..."
          class="anotation-textarea">
        </textarea>

        <div class="calendar-center-container">
          <label class="label-white">Seleccione Fecha:</label>
          <input type="date" [(ngModel)]="seleccion.fecha" class="date-input-panel centered-date">
        </div>
        
        <button class="btn-full-action green-grad" (click)="guardarFecha()">
          {{ seleccion.id_fecha_edicion ? 'GUARDAR CAMBIOS' : 'REGISTRAR FECHA' }}
        </button>
        
        <button *ngIf="seleccion.id_fecha_edicion" (click)="limpiarPanelEdicion()" class="btn-full-action" style="background: #666; margin-top: 10px;">CANCELAR</button>
      </section>

      <section class="card-white-panel">
        <h3 class="panel-title" style="color: #002d40;">Calendario de Evaluaciones</h3>
        
        <div class="grades-scroll-container">
          <div *ngIf="fechasActuales.length === 0" class="no-data">Sin evaluaciones programadas.</div>
          
          <div class="grade-row-item"
               *ngFor="let f of fechasActuales"
               (click)="seleccionarParaAccion(f)"
               [class.selected-row]="fechaSeleccionadaId === (f.id_evaluacion || f.id_anotacion)">
            <div class="anotation-content">
              <span class="badge-asig">{{ f.nombre_asignatura }}</span>
              <p class="txt-contenido">{{ f.contenido }}</p>
              <small class="txt-fecha">PROGRAMADA: {{ f.fecha | date:'dd/MM/yyyy' }}</small>
            </div>
          </div>
        </div>

        <div class="actions-footer-panel">
          <button class="btn-edit" (click)="editarFecha()" [disabled]="!fechaSeleccionadaId">EDITAR</button>
          <button class="btn-delete" (click)="borrarFecha()" [disabled]="!fechaSeleccionadaId">BORRAR</button>
        </div>
      </section>
    </div>
  </main>

  <footer class="minimal-footer"><p>Copyright ¬© 2026 | KALINK DISE√ëOS</p></footer>
</div>