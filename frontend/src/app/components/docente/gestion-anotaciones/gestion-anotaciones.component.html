<div class="dashboard-wrapper" (click)="menuOpen = false">
  <header class="header-main">
    <div class="header-left-action">
      <button class="btn-back-nav" (click)="volverDashboard()"><span>‚¨Ö</span> VOLVER</button>
    </div>
    
    <div class="logo-wrapper">
      <div class="logo-white-bg">
        <img src="assets/logo-escuela.png" alt="Logo Escuela" class="img-logo" style="width: 80%;">
      </div>
    </div>
    
    <div class="user-profile-pill">
      <span>{{ userRol | uppercase }}: {{ userName }}</span>
      <button class="menu-trigger" (click)="toggleMenu($event)">
        <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </button>
      
      <div class="dropdown-floating-menu" *ngIf="menuOpen" (click)="$event.stopPropagation()">
        <button class="dropdown-item" (click)="irAConfig()">‚öôÔ∏è Configuraci√≥n</button>
        <div style="height: 1px; background: #eee; margin: 5px 0;"></div>
        <button class="dropdown-item" (click)="cerrarSesion()">üö™ Cerrar sesi√≥n</button>
      </div>
    </div>
  </header>

  <div class="title-section-container">
    <div class="badge-title-dark">GESTI√ìN DE ANOTACIONES</div>
  </div>

  <main class="main-content-area">
    <div class="selectors-row">
      <div class="select-box">
        <select [(ngModel)]="seleccion.curso" (change)="onCursoChange()" class="clean-select">
          <option [ngValue]="null">Curso</option>
          <option *ngFor="let c of cursos" [ngValue]="c.id_curso">{{ c.nombre_curso }}</option>
        </select>
      </div>

      <div class="select-box">
        <select [(ngModel)]="seleccion.estudiante" (change)="obtenerAnotaciones()" class="clean-select">
          <option [ngValue]="null">Estudiante</option>
          <option *ngFor="let e of estudiantes" [ngValue]="e.id_estudiante">{{ e.nombre_completo }}</option>
        </select>
      </div>
    </div>

    <div class="panels-grid">
      <section class="card-dark-panel">
        <h3 class="panel-title">{{ seleccion.id_anotacion_edicion ? 'Actualizar Registro' : 'Nueva Anotaci√≥n' }}</h3>
        
        <div class="switch-container-full">
          <div class="switch-base">
            <button type="button" 
                    class="switch-option" 
                    [class.active]="seleccion.tipo === 'POSITIVA'" 
                    (click)="cambiarTipo('POSITIVA')">
              POSITIVA
            </button>
            <button type="button" 
                    class="switch-option" 
                    [class.active]="seleccion.tipo === 'NEGATIVA'" 
                    (click)="cambiarTipo('NEGATIVA')">
              NEGATIVA
            </button>
          </div>
        </div>

        <textarea 
          [(ngModel)]="seleccion.contenido" 
          placeholder="Escriba aqu√≠ la observaci√≥n del alumno..." 
          class="anotation-textarea">
        </textarea>
        
        <button class="btn-full-action green-grad" (click)="guardarAnotacion()">
          {{ seleccion.id_anotacion_edicion ? 'GUARDAR CAMBIOS' : 'REGISTRAR ANOTACI√ìN' }}
        </button>
        
        <button *ngIf="seleccion.id_anotacion_edicion" (click)="limpiarPanelEdicion()" class="btn-full-action" style="background: #666; margin-top: 10px;">CANCELAR</button>
      </section>

      <section class="card-white-panel">
        <h3 class="panel-title" style="color: #002d40;">Historial del Estudiante</h3>
        
        <div class="grades-scroll-container">
          <div *ngIf="anotacionesActuales.length === 0" class="no-data">Sin registros.</div>
          
          <div class="grade-row-item" 
               *ngFor="let a of anotacionesActuales" 
               (click)="seleccionarParaAccion(a)"
               [class.selected-row]="anotacionSeleccionadaId === a.id_anotacion">
            
            <div class="anotation-content">
              <div class="indicator-bar" [ngClass]="{'is-neg': a.tipo === 'NEGATIVA', 'is-pos': a.tipo === 'POSITIVA'}"></div>
              
              <div class="anotation-details">
                <div class="label-tipo" [ngClass]="{'txt-rojo': a.tipo === 'NEGATIVA', 'txt-verde': a.tipo === 'POSITIVA'}">
                  {{ a.tipo === 'NEGATIVA' ? 'ANOTACI√ìN NEGATIVA' : 'ANOTACI√ìN POSITIVA' }}
                </div>
                
                <p class="txt-contenido">{{ a.contenido }}</p>
                <div class="txt-meta">
                  <span class="txt-fecha">Publicado: {{ a.fecha | date:'dd/MM/yyyy' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="actions-footer-panel">
          <button class="btn-edit" (click)="editarAnotacion()">EDITAR</button>
          <button class="btn-delete" (click)="borrarAnotacion()">BORRAR</button>
        </div>
      </section>
    </div>
  </main>

  <footer class="minimal-footer"><p>Copyright ¬© 2026 | KALINK DISE√ëOS</p></footer>
</div>